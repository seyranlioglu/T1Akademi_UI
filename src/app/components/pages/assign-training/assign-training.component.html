<div class="assign-wrapper" [ngClass]="{'is-modal': isModal}">
  
  <div class="assign-header">
    <div>
      <h2 class="title">Personellere EÄŸitim Ata</h2>
      <p class="subtitle">KÃ¼tÃ¼phanenizdeki eÄŸitimleri Ã§alÄ±ÅŸanlarÄ±nÄ±za tanÄ±mlayÄ±n.</p>
    </div>
    <button *ngIf="isModal" class="btn-close-icon" (click)="closeComponent()">âœ•</button>
  </div>

  <div class="assign-body">
    
    <div class="settings-column">
      
      <div class="form-group">
        <label>EÄŸitim SeÃ§iniz <span class="text-danger">*</span></label>
        <select class="form-control" 
                [ngModel]="selectedTrainingId" 
                (ngModelChange)="onTrainingSelect($event)"
                [disabled]="isLoading">
          <option [ngValue]="null">-- EÄŸitim SeÃ§in --</option>
          <option *ngFor="let tr of libraryTrainings" [ngValue]="tr.currAccTrainingId">
            {{ tr.trainingTitle }}
          </option>
        </select>
      </div>

      <div class="quota-card" *ngIf="selectedTrainingQuotaInfo">
        <div class="quota-header">
          <span class="badge" 
                [ngClass]="selectedTrainingQuotaInfo.isCompanyOwned ? 'badge-vip' : 'badge-standard'">
            {{ selectedTrainingQuotaInfo.isCompanyOwned ? 'â­ Kuruma Ã–zel' : 'LisanslÄ± EÄŸitim' }}
          </span>
        </div>
        
        <div class="quota-details" *ngIf="selectedTrainingQuotaInfo.isUnlimited">
          <h3 class="unlimited-text">SÄ±nÄ±rsÄ±z Atama</h3>
          <p>Bu eÄŸitim firmanÄ±za Ã¶zel olduÄŸu iÃ§in kiÅŸi sÄ±nÄ±rÄ± yoktur.</p>
        </div>

        <div class="quota-details" *ngIf="!selectedTrainingQuotaInfo.isUnlimited">
          <div class="quota-stats">
            <div class="stat-box">
              <span class="stat-label">Toplam</span>
              <span class="stat-val">{{ selectedTrainingQuotaInfo.totalQuota }}</span>
            </div>
            <div class="stat-box">
              <span class="stat-label">KullanÄ±lan</span>
              <span class="stat-val">{{ selectedTrainingQuotaInfo.usedQuota }}</span>
            </div>
            <div class="stat-box highlight">
              <span class="stat-label">Kalan</span>
              <span class="stat-val">{{ selectedTrainingQuotaInfo.remainingQuota }}</span>
            </div>
          </div>
          <p class="quota-hint">
            * {{ selectedTrainingQuotaInfo.quotaType === 'Subscription' ? 'Abonelik paketinizdeki genel koltuk sayÄ±sÄ±.' : 'Bu eÄŸitime Ã¶zel satÄ±n alÄ±nan lisans sayÄ±sÄ±.' }}
          </p>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group half">
          <label>BaÅŸlangÄ±Ã§ Tarihi</label>
          <input type="date" class="form-control" [(ngModel)]="startDate" [disabled]="isLoading">
        </div>
        <div class="form-group half">
          <label>Son Bitirme (Opsiyonel)</label>
          <input type="date" class="form-control" [(ngModel)]="dueDate" [disabled]="isLoading">
        </div>
      </div>
    </div>

    <div class="users-column">
      <div class="users-header">
        <label>Personel Listesi</label>
        <span class="selected-count" *ngIf="selectedUserIds.length > 0">
          {{ selectedUserIds.length }} KiÅŸi SeÃ§ildi
        </span>
      </div>

      <div class="empty-state" *ngIf="!selectedTrainingId">
        <div class="icon">ğŸ‘ˆ</div>
        <p>LÃ¼tfen Ã¶nce sol taraftan bir eÄŸitim seÃ§iniz.</p>
      </div>

      <div class="user-list" *ngIf="selectedTrainingId">
        
        <div class="loading-state" *ngIf="isLoading">
          <span class="spinner"></span> YÃ¼kleniyor...
        </div>

        <div class="empty-state" *ngIf="!isLoading && companyUsers.length === 0">
          <p>FirmanÄ±za kayÄ±tlÄ± personel bulunamadÄ±.</p>
        </div>

        <label class="user-item" 
               *ngFor="let user of companyUsers" 
               [ngClass]="{'is-assigned': user.isAssigned}">
          
          <div class="user-checkbox">
            <input type="checkbox" 
                   [checked]="user.isAssigned || selectedUserIds.includes(user.userId)"
                   [disabled]="user.isAssigned || isLoading"
                   (change)="toggleUserSelection(user.userId, $event)">
          </div>
          
          <div class="user-info">
            <h4 class="user-name">{{ user.fullName }}</h4>
            <span class="user-title" *ngIf="user.title">{{ user.title }}</span>
          </div>

          <div class="user-status">
            <span class="badge badge-success" *ngIf="user.isAssigned">Zaten AtanmÄ±ÅŸ</span>
          </div>
        </label>

      </div>
    </div>
  </div>

  <div class="assign-footer">
    <button class="btn btn-outline" (click)="closeComponent()" [disabled]="isLoading">
      Ä°ptal
    </button>
    <button class="btn btn-primary" 
            (click)="submitAssignment()" 
            [disabled]="isLoading || !selectedTrainingId || selectedUserIds.length === 0">
      <span *ngIf="isLoading" class="spinner-small"></span>
      {{ isLoading ? 'Ä°ÅŸleniyor...' : 'SeÃ§ili Personellere Ata' }}
    </button>
  </div>

</div>