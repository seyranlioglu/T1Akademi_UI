<div class="assign-container" [ngClass]="{'is-modal': isModal}">
  <header class="assign-top-bar">
    <div class="title-group">
      <h1>EÄŸitim Atama Merkezi</h1>
      <span class="step-indicator">Planlama yapÄ±n ve personelleri seÃ§erek iÅŸlemi tamamlayÄ±n.</span>
    </div>
    
    <div class="top-actions">
      <button *ngIf="isModal" class="btn-cancel" (click)="closeComponent()">Kapat</button>
      <button class="btn-submit" 
              [disabled]="!selectedTrainingId || selectedUserIds.length === 0 || isLoading"
              (click)="submitAssignment()">
        <span *ngIf="!isLoading">AtamayÄ± Tamamla</span>
        <span *ngIf="isLoading" class="loader"></span>
      </button>
    </div>
  </header>

  <div class="assign-main-content">
    
    <aside class="training-sidebar">
      <div class="panel-label">EÄŸitim KÃ¼tÃ¼phanesi</div>
      <div class="training-scroll">
        <div *ngFor="let tr of libraryTrainings" 
             class="training-item" 
             [ngClass]="{'active': selectedTrainingId === tr.currAccTrainingId}"
             (click)="onTrainingSelect(tr.currAccTrainingId)">
          
          <div class="tr-thumb">
            <img [src]="tr.trainingImage || 'assets/img/default-course.png'">
          </div>
          <div class="tr-details">
            <span class="tr-name">{{ tr.trainingTitle }}</span>
            <div class="tr-info-line">
              <span class="quota" [ngClass]="{'text-danger': tr.remainingQuota < 5}">Kalan: <strong>{{ tr.remainingQuota }}</strong></span>
              <span class="type-tag">{{ tr.quotaType }}</span>
            </div>
          </div>
          <div class="active-indicator"></div>
        </div>
      </div>
    </aside>

    <main class="assignment-panel">
      
      <section class="schedule-bar">
        <div class="section-title">ðŸ“… 1. Zamanlama AyarlarÄ±</div>
        <div class="input-grid">
          <div class="form-field">
            <label>BaÅŸlangÄ±Ã§ Tarihi</label>
            <input type="date" [(ngModel)]="startDate" class="modern-input">
          </div>
          <div class="form-field">
            <label>Son Bitirme Tarihi (Opsiyonel)</label>
            <input type="date" [(ngModel)]="dueDate" class="modern-input">
          </div>
        </div>
      </section>

      <section class="personnel-section">
        <div class="section-header-inline">
          <div class="section-title">ðŸ‘¥ 2. Personel Atama Durumu</div>
          <div class="selection-summary" *ngIf="selectedUserIds.length">
            <strong>{{ selectedUserIds.length }}</strong> Personel SeÃ§ildi
          </div>
        </div>

        <div class="empty-placeholder" *ngIf="!selectedTrainingId">
          <div class="placeholder-content">
            <div class="placeholder-icon">ðŸ‘ˆ</div>
            <p>Atama sÃ¼recini baÅŸlatmak iÃ§in sol listeden bir eÄŸitim seÃ§in.</p>
          </div>
        </div>

        <div class="user-table-wrapper" *ngIf="selectedTrainingId">
          <table class="user-table">
            <thead>
              <tr>
                <th width="50">
                  <label class="custom-check">
                    <input type="checkbox" 
                           (change)="toggleAllUsers($event)"
                           [checked]="isAllSelected()">
                    <span class="checkmark"></span>
                  </label>
                </th>
                <th>Personel Bilgisi</th>
                <th>Pozisyon</th>
                <th class="text-center">Durum</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of companyUsers" [ngClass]="{'already-assigned': user.isAssigned}">
                <td>
                  <label class="custom-check" [ngClass]="{'disabled': user.isAssigned}">
                    <input type="checkbox" 
                           [checked]="user.isAssigned || selectedUserIds.includes(user.userId)"
                           [disabled]="user.isAssigned"
                           (change)="toggleUserSelection(user.userId, $event)">
                    <span class="checkmark"></span>
                  </label>
                </td>
                <td>
                  <div class="name-cell">
                    <div class="avatar">{{ user.fullName[0] }}</div>
                    <div class="user-text">
                      <span class="name">{{ user.fullName }}</span>
                      <span class="email">{{ user.email }}</span>
                    </div>
                  </div>
                </td>
                <td><span class="title-text">{{ user.title || 'Personel' }}</span></td>
                <td class="text-center">
                  <span class="status-pill" [ngClass]="user.isAssigned ? 'assigned' : 'not-assigned'">
                    {{ user.isAssigned ? 'AtandÄ±' : 'MÃ¼sait' }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

  </div>
</div>