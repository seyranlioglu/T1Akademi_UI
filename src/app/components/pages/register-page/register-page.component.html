<div class="container-fluid vh-100 p-0 overflow-hidden">
    <div class="row g-0 h-100">
        
        <div class="col-lg-5 d-none d-lg-flex align-items-center justify-content-center bg-branding position-relative">
            <div class="text-center p-5 fade-in-up layer-z">
                <img src="assets/images/logos/t1-logo-text.png" alt="T1 Akademi Logo" class="brand-logo mb-4">
                <h2 class="text-white fw-light mb-3">Aramıza Katılın</h2>
                <p class="text-white-50 lead fs-6" style="max-width: 400px; margin: 0 auto;">
                    T1 Akademi dünyasına adım atın, kurumsal gelişiminizi hızlandırın.
                </p>
            </div>
            <div class="bg-overlay"></div>
        </div>

        <div class="col-lg-7 d-flex flex-column h-100 bg-light-mobile scrollable-column">
            
            <div class="flex-grow-1 d-flex justify-content-center py-5 px-3">
                <div class="register-wrapper w-100">
                    
                    <div class="text-center mb-4 d-lg-none">
                        <img src="assets/images/logos/t1-logo-text.png" alt="Logo" style="height: 45px; width: auto;">
                    </div>

                    <div class="text-center mb-4">
                        <h3 class="fw-bold text-dark">
                            <ng-container *ngIf="currentStep === 1">Hesap Oluştur</ng-container>
                            <ng-container *ngIf="currentStep === 2">Kurumsal Bilgiler</ng-container>
                            <ng-container *ngIf="currentStep > 2">Doğrulama</ng-container>
                        </h3>
                        
                        <div class="d-flex justify-content-center mt-3" *ngIf="currentStep < 3">
                            <span class="badge rounded-pill me-2 px-3 py-2 transition-badge" 
                                  [ngClass]="currentStep === 1 ? 'bg-warning text-dark' : 'bg-light text-muted border'">
                                1. Kişisel
                            </span>
                            <span class="text-muted align-self-center mx-1"><i class='bx bx-chevron-right'></i></span>
                            <span class="badge rounded-pill ms-2 px-3 py-2 transition-badge" 
                                  [ngClass]="currentStep === 2 ? 'bg-warning text-dark' : 'bg-light text-muted border'">
                                2. Kurumsal
                            </span>
                        </div>
                    </div>

                    <form [formGroup]="registerForm">
                        
                        <div class="row g-3 fade-in" *ngIf="currentStep === 1">
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" formControlName="name" class="form-control" id="nameInput" placeholder="Ad"
                                           [class.is-invalid]="f['name'].invalid && (f['name'].dirty || f['name'].touched)">
                                    <label for="nameInput">Ad</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" formControlName="surname" class="form-control" id="surnameInput" placeholder="Soyad"
                                           [class.is-invalid]="f['surname'].invalid && (f['surname'].dirty || f['surname'].touched)">
                                    <label for="surnameInput">Soyad</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-floating">
                                    <input type="email" formControlName="email" class="form-control" id="emailInput" placeholder="E-Posta"
                                           [class.is-invalid]="f['email'].invalid && (f['email'].dirty || f['email'].touched)">
                                    <label for="emailInput">E-Posta Adresi</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-floating">
                                    <input type="tel" formControlName="phoneNumber" class="form-control" id="phoneInput" placeholder="Telefon"
                                           (input)="onPhoneInput($event)"
                                           [class.is-invalid]="f['phoneNumber'].invalid && (f['phoneNumber'].dirty || f['phoneNumber'].touched)">
                                    <label for="phoneInput">Telefon (05XX...)</label>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating position-relative">
                                    <input [type]="showPassword ? 'text' : 'password'" formControlName="password" class="form-control pr-5" id="passInput" placeholder="Şifre"
                                           (input)="checkPasswordRules()"
                                           [class.is-invalid]="f['password'].invalid && (f['password'].dirty || f['password'].touched)">
                                    <label for="passInput">Şifre</label>
                                    
                                    <i class='bx' [ngClass]="showPassword ? 'bx-show' : 'bx-hide'" 
                                       class="password-toggle" 
                                       (click)="showPassword = !showPassword"></i>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating position-relative">
                                    <input [type]="showConfirmPassword ? 'text' : 'password'" formControlName="passwordConfirm" class="form-control pr-5" id="passConfInput" placeholder="Şifre Tekrar"
                                           (input)="checkPasswordRules()"
                                           [class.is-invalid]="f['passwordConfirm'].invalid && (f['passwordConfirm'].dirty || f['passwordConfirm'].touched)">
                                    <label for="passConfInput">Şifre Tekrar</label>
                                    
                                    <i class='bx' [ngClass]="showConfirmPassword ? 'bx-show' : 'bx-hide'" 
                                       class="password-toggle" 
                                       (click)="showConfirmPassword = !showConfirmPassword"></i>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="p-3 bg-light rounded border border-light">
                                    <small class="fw-bold d-block mb-2 text-muted">Şifre Gereksinimleri:</small>
                                    <div class="row g-2 small">
                                        <div class="col-md-6" [ngClass]="passwordCriteria.length ? 'text-success' : 'text-danger'">
                                            <i class='bx' [ngClass]="passwordCriteria.length ? 'bx-check-circle' : 'bx-x-circle'"></i> En az 8 karakter
                                        </div>
                                        <div class="col-md-6" [ngClass]="passwordCriteria.upperCase ? 'text-success' : 'text-danger'">
                                            <i class='bx' [ngClass]="passwordCriteria.upperCase ? 'bx-check-circle' : 'bx-x-circle'"></i> En az 1 büyük harf
                                        </div>
                                        <div class="col-md-6" [ngClass]="passwordCriteria.number ? 'text-success' : 'text-danger'">
                                            <i class='bx' [ngClass]="passwordCriteria.number ? 'bx-check-circle' : 'bx-x-circle'"></i> En az 1 rakam
                                        </div>
                                        <div class="col-md-6" [ngClass]="passwordCriteria.specialChar ? 'text-success' : 'text-danger'">
                                            <i class='bx' [ngClass]="passwordCriteria.specialChar ? 'bx-check-circle' : 'bx-x-circle'"></i> En az 1 özel karakter
                                        </div>
                                        <div class="col-md-6" [ngClass]="passwordCriteria.noSequential ? 'text-success' : 'text-danger'">
                                            <i class='bx' [ngClass]="passwordCriteria.noSequential ? 'bx-check-circle' : 'bx-x-circle'"></i> Ardışık karakter yok
                                        </div>
                                        <div class="col-md-6" [ngClass]="passwordCriteria.match ? 'text-success' : 'text-danger'">
                                            <i class='bx' [ngClass]="passwordCriteria.match ? 'bx-check-circle' : 'bx-x-circle'"></i> Şifreler eşleşiyor
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 mt-4">
                                <button type="button" class="btn btn-primary btn-lg w-100 py-3 fw-bold" (click)="goToStep2()">
                                    Devam Et <i class='bx bx-right-arrow-alt'></i>
                                </button>
                            </div>
                        </div>

                        <div class="row g-3 fade-in" *ngIf="currentStep === 2">
                            <div class="col-12">
                                <div class="form-floating">
                                    <input type="text" formControlName="title" class="form-control" id="titleInput" placeholder="Unvan"
                                           [class.is-invalid]="f['title'].invalid && (f['title'].dirty || f['title'].touched)">
                                    <label for="titleInput">Şirket Unvanı</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" formControlName="taxNumber" class="form-control" id="taxInput" placeholder="Vergi No" maxlength="10" (keypress)="numberOnly($event)"
                                           [class.is-invalid]="f['taxNumber'].invalid && (f['taxNumber'].dirty || f['taxNumber'].touched)">
                                    <label for="taxInput">Vergi No</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" formControlName="postalCode" class="form-control" id="postalInput" placeholder="Posta Kodu" maxlength="5" (keypress)="numberOnly($event)"
                                           [class.is-invalid]="f['postalCode'].invalid && (f['postalCode'].dirty || f['postalCode'].touched)">
                                    <label for="postalInput">Posta Kodu</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-floating">
                                    <textarea formControlName="address" class="form-control" id="addressInput" placeholder="Adres" style="height: 100px"
                                              [class.is-invalid]="f['address'].invalid && (f['address'].dirty || f['address'].touched)"></textarea>
                                    <label for="addressInput">Fatura Adresi</label>
                                </div>
                            </div>
                            
                            <div class="col-12 mt-4 d-flex gap-3">
                                <button type="button" class="btn btn-outline-secondary btn-lg w-50 py-3" (click)="goBackToStep1()">
                                    <i class='bx bx-left-arrow-alt'></i> Geri
                                </button>
                                <button type="button" class="btn btn-primary btn-lg w-50 py-3 fw-bold" (click)="submitRegister()" [disabled]="(isLoading$ | async)">
                                    {{ (isLoading$ | async) ? 'Kayıt Olunuyor...' : 'Kayıt Ol' }}
                                </button>
                            </div>
                        </div>
                    </form>

                    <form [formGroup]="verifyForm" (ngSubmit)="submitVerify()" *ngIf="currentStep === 3 || currentStep === 4" class="fade-in text-center">
                         <div class="py-4">
                             <p class="mb-4 text-dark fw-medium">
                                <span *ngIf="currentStep === 3">Lütfen <b>{{ registeredEmail }}</b> adresine gelen kodu giriniz.</span>
                                <span *ngIf="currentStep === 4">Lütfen <b>{{ registeredPhoneNumber }}</b> numarasına gelen SMS kodunu giriniz.</span>
                            </p>

                            <input type="text" formControlName="code" class="form-control form-control-lg text-center mx-auto shadow-sm mb-4" 
                                   style="font-size: 2rem; letter-spacing: 0.8rem; max-width: 250px; height: 70px; border-radius: 15px;" 
                                   placeholder="••••" maxlength="6" (keypress)="numberOnly($event)">

                            <button type="submit" class="btn btn-primary btn-lg w-100 py-3 fw-bold">
                                {{ currentStep === 3 ? 'E-Postayı Doğrula' : 'Telefonu Doğrula' }}
                            </button>

                            <div class="mt-4">
                                <span *ngIf="remainingTime > 0" class="text-muted small">
                                    <i class="bx bx-time"></i> Kalan Süre: <b>{{ remainingTime }}</b> sn
                                </span>
                                <span *ngIf="remainingTime === 0">
                                    <button type="button" class="btn btn-link text-warning-dark fw-bold text-decoration-none" (click)="resendCurrentCode()">
                                        Kodu Tekrar Gönder <i class='bx bx-refresh'></i>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </form>

                    <div class="text-center mt-4">
                        <span class="text-muted small">Zaten hesabınız var mı? </span>
                        <a routerLink="/auth/login" class="text-decoration-none fw-bold text-warning-dark">Giriş Yap</a>
                    </div>
                </div>
            </div>

            <div class="py-3 text-center bg-light-mobile">
                <small class="text-muted" style="font-size: 0.75rem;">&copy; 2026 T1 Akademi.</small>
            </div>
        </div>
    </div>
</div>