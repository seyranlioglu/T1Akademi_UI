<div class="player-wrapper" [class.sidebar-closed]="!isSidebarOpen">

    <div *ngIf="isLoading" class="d-flex justify-content-center align-items-center vh-100 bg-dark text-white">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Yükleniyor...</span>
        </div>
    </div>

    <ng-container *ngIf="!isLoading && course">
        
        <div class="player-header d-flex justify-content-between align-items-center px-4 py-3 bg-dark border-bottom border-secondary">
            <div class="d-flex align-items-center gap-3">
                <a routerLink="/dashboard" class="text-white text-decoration-none">
                    <i class='bx bx-chevron-left fs-4'></i> Geri
                </a>
                <h5 class="text-white m-0 d-none d-md-block">{{ course.title }}</h5>
            </div>
            
            <div class="d-flex align-items-center gap-3">
                <span class="badge bg-warning text-dark" *ngIf="previewToken">Önizleme Modu</span>
                <span class="text-white-50 small d-none d-md-block">İlerleme: %0</span>
            </div>
        </div>

        <div class="player-body d-flex">

            <div class="player-content flex-grow-1 bg-black position-relative">
                
                <div class="video-container d-flex align-items-center justify-content-center bg-black" style="min-height: 500px;">
                    <div *ngIf="activeContent" class="text-center w-100">
                        <div class="d-flex flex-column align-items-center">
                            <i class='bx bx-play-circle text-white display-1 mb-3 opacity-50'></i>
                            <h3 class="text-white">{{ activeContent.title }}</h3>
                            <p class="text-white-50">Süre: {{ activeContent.durationMinutes }} dakika</p>
                        </div>
                    </div>
                    <div *ngIf="!activeContent" class="text-white-50">İçerik seçiniz...</div>
                </div>

                <div class="content-tabs bg-white p-4">
                    <ul class="nav nav-tabs mb-4">
                        <li class="nav-item">
                            <button class="nav-link" [class.active]="activeTab === 'overview'" (click)="setActiveTab('overview')">Genel Bakış</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" [class.active]="activeTab === 'reviews'" (click)="setActiveTab('reviews')">Yorumlar</button>
                        </li>
                    </ul>

                    <div *ngIf="activeTab === 'overview'">
                        <h4 class="fw-bold mb-3">Kurs Hakkında</h4>
                        <div [innerHTML]="course.description" class="text-muted mb-4"></div>

                        <div class="row mb-4" *ngIf="course.whatYouWillLearn?.length">
                            <div class="col-12"><h5 class="fw-bold">Neler Öğreneceksiniz?</h5></div>
                            <div class="col-md-6 mb-2" *ngFor="let item of course.whatYouWillLearn">
                                <i class='bx bx-check text-success me-2'></i> {{ item }}
                            </div>
                        </div>

                        <div class="mb-4" *ngIf="course.requirements?.length">
                            <h5 class="fw-bold">Gereksinimler</h5>
                            <ul class="list-unstyled">
                                <li *ngFor="let req of course.requirements" class="mb-1">
                                    <i class='bx bxs-circle text-secondary me-2' style="font-size: 6px; vertical-align: middle;"></i> {{ req }}
                                </li>
                            </ul>
                        </div>
                        
                        <div class="mb-4" *ngIf="course.instructorName">
                            <h5 class="fw-bold">Eğitmen</h5>
                            <div class="d-flex align-items-center gap-3 mt-3">
                                <img [src]="course.instructorImage || 'assets/images/defaults/defaultuser.png'" class="rounded-circle" width="60" height="60">
                                <div>
                                    <h6 class="m-0 fw-bold">{{ course.instructorName }}</h6>
                                    <small class="text-muted">{{ course.instructorTitle }}</small>
                                </div>
                            </div>
                            <p class="mt-3 text-muted small" style="white-space: pre-line;">{{ course.instructorBio }}</p>
                        </div>
                    </div>

                    <div *ngIf="activeTab === 'reviews'">
                        <div *ngFor="let review of course.topReviews" class="d-flex gap-3 mb-4 pb-3 border-bottom">
                            <img [src]="review.userImage || 'assets/images/defaults/defaultuser.png'" class="rounded-circle" width="50" height="50">
                            <div>
                                <h6 class="fw-bold mb-1">{{ review.userName }}</h6>
                                <div class="text-warning small mb-2">
                                    <i class='bx bxs-star' *ngFor="let s of [1,2,3,4,5]; let i=index" [class.text-muted]="i >= review.rating"></i>
                                </div>
                                <p class="text-muted m-0">{{ review.comment }}</p>
                            </div>
                        </div>
                        <div *ngIf="!course.topReviews?.length" class="text-muted">Henüz yorum yapılmamış.</div>
                    </div>
                </div>

            </div>

            <div class="player-sidebar bg-white border-start" [class.closed]="!isSidebarOpen" style="width: 350px; min-width: 350px;">
                <div class="d-flex justify-content-between align-items-center p-3 border-bottom bg-light">
                    <h6 class="m-0 fw-bold">Kurs İçeriği</h6>
                    <button class="btn btn-sm btn-outline-secondary" (click)="toggleSidebar()">
                        <i class='bx' [class.bx-x]="isSidebarOpen" [class.bx-menu]="!isSidebarOpen"></i>
                    </button>
                </div>

                <div class="sidebar-content overflow-auto" style="height: calc(100vh - 120px);">
                    <div class="accordion accordion-flush" id="playerAccordion">
                        <div class="accordion-item" *ngFor="let section of course.sections; let i = index">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed py-3 bg-light" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#section'+i">
                                    <div class="d-flex flex-column">
                                        <span class="fw-bold small">Bölüm {{ i + 1 }}: {{ section.title }}</span>
                                        <span class="text-muted" style="font-size: 11px;">{{ section.contents.length }} ders</span>
                                    </div>
                                </button>
                            </h2>
                            <div [id]="'section'+i" class="accordion-collapse collapse" [class.show]="i === 0" data-bs-parent="#playerAccordion">
                                <div class="accordion-body p-0">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item list-group-item-action cursor-pointer border-0 py-3 ps-4" 
                                            *ngFor="let content of section.contents"
                                            [class.active-content]="activeContent?.id === content.id"
                                            (click)="playContent(content)">
                                            
                                            <div class="d-flex gap-2">
                                                <div class="mt-1">
                                                    <input type="checkbox" class="form-check-input" [checked]="false" (click)="$event.stopPropagation()">
                                                </div>
                                                <div>
                                                    <p class="m-0 small fw-medium" [class.text-primary]="activeContent?.id === content.id">{{ content.title }}</p>
                                                    <div class="d-flex align-items-center gap-2 mt-1">
                                                        <i class='bx bx-play-circle text-muted' style="font-size: 12px;"></i>
                                                        <span class="text-muted" style="font-size: 11px;">{{ content.durationMinutes }} dk</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </ng-container>
</div>